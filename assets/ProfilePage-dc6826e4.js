import{t as ae,$ as te,c as re,r as i,d as ne,e as B,m as le,f as ie,g as E,h as ce,i as de,j as e,k as ue,l as me,n as pe,u as T,a as fe}from"./index-8fcd2ec0.js";import{u as _,d as be}from"./useProfileThreads-1bf91c97.js";import{a as C}from"./axios-21b846bc.js";import{g as xe}from"./urlsPost-9698314f.js";import{u as R}from"./useMyProfileData-9b5aba83.js";import{u as he,s as ge,g as ve,r as we}from"./useGetNotifications-a923214d.js";import{g as ye}from"./urlsUsers-ca1c08d1.js";import{M as ke,E as je}from"./EditProfile-30e190cf.js";import{$ as Pe,u as Ce}from"./import-254cb850.js";import{d as Ne,u as $e,a as Oe,c as O,A as Se,b as Be}from"./chunk-IPGVXZ3J-676002ec.js";import{B as Ie}from"./baseUrl-32bae851.js";import"./cropper-b8512016.js";import"./Combination-11f5bee2.js";var U=ae({slots:{wrapper:["flex","w-screen","h-[100dvh]","fixed","inset-0","z-50","overflow-x-auto","justify-center","[--scale-enter:100%]","[--scale-exit:100%]","[--slide-enter:0px]","[--slide-exit:80px]","sm:[--scale-enter:100%]","sm:[--scale-exit:103%]","sm:[--slide-enter:0px]","sm:[--slide-exit:0px]"],base:["flex","flex-col","relative","bg-white","z-50","w-full","box-border","bg-content1","outline-none","mx-1","my-1","sm:mx-6","sm:my-16"],backdrop:"z-50",header:"flex py-4 px-6 flex-initial text-large font-semibold",body:"flex flex-1 flex-col gap-3 px-6 py-2",footer:"flex flex-row gap-2 px-6 py-4 justify-end",closeButton:["absolute","appearance-none","outline-none","select-none","top-1","right-1","p-2","text-foreground-500","rounded-full","hover:bg-default-100","active:bg-default-200","tap-highlight-transparent",...Ne]},variants:{size:{xs:{base:"max-w-xs"},sm:{base:"max-w-sm"},md:{base:"max-w-md"},lg:{base:"max-w-lg"},xl:{base:"max-w-xl"},"2xl":{base:"max-w-2xl"},"3xl":{base:"max-w-3xl"},"4xl":{base:"max-w-4xl"},"5xl":{base:"max-w-5xl"},full:{base:"my-0 mx-0 sm:mx-0 sm:my-0 max-w-full h-[100dvh] !rounded-none"}},radius:{none:{base:"rounded-none"},sm:{base:"rounded-small"},md:{base:"rounded-medium"},lg:{base:"rounded-large"}},placement:{auto:{wrapper:"items-end sm:items-center"},center:{wrapper:"items-center sm:items-center"},top:{wrapper:"items-start sm:items-start"},"top-center":{wrapper:"items-start sm:items-center"},bottom:{wrapper:"items-end sm:items-end"},"bottom-center":{wrapper:"items-end sm:items-center"}},shadow:{sm:{base:"shadow-small"},md:{base:"shadow-medium"},lg:{base:"shadow-large"}},backdrop:{transparent:{backdrop:"hidden"},opaque:{backdrop:"bg-overlay/50 backdrop-opacity-disabled"},blur:{backdrop:"backdrop-blur-md backdrop-saturate-150 bg-overlay/30"}},scrollBehavior:{normal:{base:"overflow-y-hidden"},inside:{base:"max-h-[calc(100%_-_7.5rem)]",body:"overflow-y-auto"},outside:{wrapper:"items-start sm:items-start overflow-y-auto",base:"my-16"}}},defaultVariants:{size:"md",radius:"lg",shadow:"sm",placement:"auto",backdrop:"opaque",scrollBehavior:"normal"},compoundVariants:[{backdrop:["opaque","blur"],class:{backdrop:"w-screen h-screen fixed inset-0"}}]});function Ae(a={},o,t){let{overlayProps:s,underlayProps:r}=te({...a,isOpen:o.isOpen,onClose:o.close},t);return re(),i.useEffect(()=>{if(o.isOpen&&t.current)return ne([t.current])},[o.isOpen,t]),{modalProps:B(s),underlayProps:r}}function De(a){var o;const[t,s]=le(a,U.variantKeys),{ref:r,as:l,className:h,classNames:c,disableAnimation:g=!1,isOpen:f,defaultOpen:w,onOpenChange:v,motionProps:d,closeButton:m,isDismissable:n=!0,hideCloseButton:u=!1,shouldBlockScroll:y=!0,portalContainer:p,isKeyboardDismissDisabled:b=!1,onClose:x,...k}=t,$=l||"section",S=$e(r),V=i.useRef(null),[q,G]=i.useState(!1),[H,K]=i.useState(!1),L=i.useId(),I=i.useId(),A=i.useId(),P=Pe({isOpen:f,defaultOpen:w,onOpenChange:j=>{v==null||v(j),j||x==null||x()}}),{modalProps:J,underlayProps:D}=Ae({isDismissable:n,isKeyboardDismissDisabled:b},P,S),{buttonProps:Q}=Oe({onPress:P.close},V),{isFocusVisible:W,focusProps:X}=ie(),Y=E(c==null?void 0:c.base,h),N=i.useMemo(()=>U({...s}),[...Object.values(s)]),Z=(j={},oe=null)=>({ref:ce(oe,S),...B(J,k,j),className:N.base({class:E(Y,j.className)}),id:L,"data-open":O(P.isOpen),"data-dismissable":O(n),"aria-modal":O(!0),"aria-labelledby":q?I:void 0,"aria-describedby":H?A:void 0}),ee=i.useCallback((j={})=>({className:N.backdrop({class:c==null?void 0:c.backdrop}),onClick:()=>P.close(),...D,...j}),[N,c,D]),se=()=>({role:"button",tabIndex:0,"aria-label":"Close","data-focus-visible":O(W),className:N.closeButton({class:c==null?void 0:c.closeButton}),...B(Q,X)});return{Component:$,slots:N,domRef:S,headerId:I,bodyId:A,motionProps:d,classNames:c,isDismissable:n,closeButton:m,hideCloseButton:u,portalContainer:p,shouldBlockScroll:y,backdrop:(o=a.backdrop)!=null?o:"opaque",isOpen:P.isOpen,onClose:P.close,disableAnimation:g,setBodyMounted:K,setHeaderMounted:G,getDialogProps:Z,getBackdropProps:ee,getCloseButtonProps:se}}var z=de((a,o)=>{const{children:t,...s}=a,r=De({...s,ref:o}),l=e.jsx(ue,{portalContainer:r.portalContainer,children:t});return e.jsx(ke,{value:r,children:r.disableAnimation&&r.isOpen?l:e.jsx(Se,{children:r.isOpen?l:null})})});z.displayName="NextUI.Modal";var Ee=z;function M(a,o=[]){const t=i.useRef(a);return Ce(()=>{t.current=a}),i.useCallback((...s)=>{var r;return(r=t.current)==null?void 0:r.call(t,...s)},o)}function Ue(a={}){const{id:o,defaultOpen:t,isOpen:s,onClose:r,onOpen:l,onChange:h=()=>{}}=a,c=M(l),g=M(r),[f,w]=me(s,t||!1,h),v=i.useId(),d=o||v,m=s!==void 0,n=i.useCallback(()=>{m||w(!1),g==null||g()},[m,g]),u=i.useCallback(()=>{m||w(!0),c==null||c()},[m,c]),y=i.useCallback(()=>{(f?n:u)()},[f,u,n]);return{isOpen:!!f,onOpen:u,onClose:n,onOpenChange:y,isControlled:m,getButtonProps:(p={})=>({...p,"aria-expanded":f,"aria-controls":d,onClick:pe(p.onClick,y)}),getDisclosureProps:(p={})=>({...p,hidden:!f,id:d})}}function Me(a){const[o,t]=i.useState([]);return i.useEffect(()=>{async function s(){var r;try{const l=window.localStorage.getItem("token"),h=await C.get(xe((r=a==null?void 0:a.user)==null?void 0:r.id),{headers:{Authorization:`Token ${l}`}});t(h.data)}catch(l){console.error("Error al obtener los datos del usuario:",l)}}s()},[a]),{userPosts:o}}function F(){const{username:a}=T(),{threads:o}=_(),{myUserId:t,myUsername:s}=R(),{notification:r,allNotifications:l}=he(),[h,c]=i.useState([]),[g,f]=i.useState(null),[w,v]=i.useState(null),d=h.find(m=>m.user.username===a);return i.useEffect(()=>{async function m(){try{const n=await C.get(ye);c(n.data);const u=o.find(p=>{const{first_person:b,second_person:x}=p;return b===s&&x===a||b===a&&x===s});v(u);const y=l.find(p=>{var k,$;const{sender:b,receiver:x}=p;return b===t&&x===((k=d==null?void 0:d.user)==null?void 0:k.id)||b===(($=d==null?void 0:d.user)==null?void 0:$.id)&&x===t});f(y)}catch(n){console.error("Error al obtener los datos del usuario:",n)}}m()},[s,o,a,t,r]),{hasSentNotification:g,currentThread:w,userData:h,user:d,setHasSentNotification:f,setCurrentThread:v}}function Te({username:a}){const{myUsername:o,myUserId:t}=R(),{user:s,setHasSentNotification:r,setCurrentThread:l,hasSentNotification:h,currentThread:c}=F(),{isOpen:g,onOpen:f,onOpenChange:w}=Ue(),v=async()=>{try{const n=window.localStorage.getItem("token");await C.post(ge,{receiver:a},{headers:{Authorization:`Token ${n}`}}),r(!0)}catch(n){console.error("Error al enviar la notificación:",n)}},d=async()=>{try{const n=window.localStorage.getItem("token");if(c){const u=c.id;await C.delete(be(u),{headers:{Authorization:`Token ${n}`}}),l(null)}}catch(n){console.error("Error al eliminar la notificación:",n)}},m=async()=>{var n;try{const u=window.localStorage.getItem("token"),p=(n=(await C.get(ve,{headers:{Authorization:`Token ${u}`}})).data.find(b=>{var x,k;return b.sender===t&&b.receiver===((x=s==null?void 0:s.user)==null?void 0:x.id)||b.sender===((k=s==null?void 0:s.user)==null?void 0:k.id)&&b.receiver===t}))==null?void 0:n.id;await C.delete(we(p),{headers:{Authorization:`Token ${u}`}}),r(null)}catch(u){console.error("Error al eliminar la notificación:",u)}};return e.jsx(e.Fragment,{children:o&&e.jsx(e.Fragment,{children:o===a?e.jsxs(e.Fragment,{children:[e.jsx(Be,{onPress:f,className:"font-bold btns-profile",children:"Editar Perfil"}),e.jsx(Ee,{isOpen:g,onOpenChange:w,placement:"top-center",className:"rounded-lg bg-palette-3",children:e.jsx(je,{})})]}):c?e.jsxs("button",{onClick:d,className:"transition-all btns-profile group hover:bg-red-950 hover:text-red-600 hover:opacity-100 hover:border-red-600",children:[e.jsx("span",{className:"group-hover:hidden",children:"Siguiendo"}),e.jsx("span",{className:"hidden group-hover:block",children:"Dejar de seguir"})]}):h?e.jsxs("button",{className:"transition-all btns-profile group hover:bg-red-950 hover:text-red-600 hover:opacity-100 hover:border-red-600",onClick:m,children:[e.jsx("span",{className:"group-hover:hidden",children:"Solicitud enviada"}),e.jsx("span",{className:"hidden group-hover:block",children:"Cancelar Solicitud"})]}):e.jsx("button",{onClick:v,className:"btns-profile",children:e.jsx("span",{children:"Seguir"})})})})}function Xe(){const{threads:a}=_(),{username:o}=T(),{userData:t,user:s}=F(),{userPosts:r}=Me(s);return e.jsxs("div",{className:"flex-col h-screen md:w-full md:h-full md:flex md:rounded-r-2xl",children:[t?e.jsxs("header",{className:"box-border relative p-5 flex items-center md:mx-auto break-all md:min-h-1/4 md:gap-5 md:w-full border-b-2 border-[#4d4d4d]",children:[e.jsx("section",{className:"flex flex-col",children:e.jsx("img",{src:s&&s.foto_perfil,className:"flex object-cover w-20 h-20 rounded-full md:h-36 md:w-36",alt:"Foto de perfil"})}),e.jsxs("div",{className:"relative flex flex-col gap-4 ml-10 text-white md:ml-8",children:[e.jsxs("section",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"mr-4 overflow-x-auto text-xl font-extrabold md:text-2xl whitespace-nowrap",children:o.charAt(0).toUpperCase()+o.slice(1)}),e.jsx(Te,{username:o})]}),e.jsx("section",{className:"flex",children:e.jsx("p",{className:"break-words",children:s&&s.descripcion})}),e.jsx("section",{children:e.jsxs("p",{className:"mx-auto break-words",children:[e.jsx("strong",{children:a.filter(l=>l.first_person===o||l.second_person===o).length})," Amigos"]})})]})]}):e.jsx("p",{children:"Perfil inexistente."}),e.jsx("main",{className:"grid justify-center grid-cols-3 gap-4 mt-5 mb-8 lg:px-6 max-lg:px-4 max-lg:gap-3",children:r.map(l=>e.jsx("div",{children:e.jsx(fe,{to:`/publicacion/${l.id}`,children:e.jsx("img",{src:`${Ie}${l.image}`,alt:"Publicación",className:"object-cover w-full transition-opacity rounded-md hover:opacity-70",loading:"lazy"})})},l.id))})]})}export{Xe as ProfilePage,Xe as default};
