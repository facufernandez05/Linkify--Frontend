import{r as a,j as e,L as w,_ as E,s as N}from"./index-f33d37de.js";import{a as y}from"./axios-21b846bc.js";import{c as F,u as S}from"./useProfileThreads-bf1302ec.js";import{u as C}from"./useMyProfileData-3913a7c4.js";import{i as P}from"./chunk-XQ2PV7KF-087327bd.js";import{b as A}from"./chunk-IPGVXZ3J-dbcb5a3b.js";import{s as v}from"./chunk-26CMBM6O-2a2f4158.js";import{a as M}from"./urlsUsers-ca1c08d1.js";import{B as T}from"./baseUrl-32bae851.js";const L=({myUserId:i,selectedThreadId:r})=>{const[l,c]=a.useState(""),[h,f]=a.useState([]),[o,d]=a.useState(!1),s=async m=>{if(m.preventDefault(),l.trim()!==""){d(!0);try{const n={thread:r,user:i,message:l},t=await y.post(F,n);f(p=>[...p,{message:t.data.message,sent_by:t.data.user,thread_id:r}]),c("")}catch(n){console.error("Error al enviar el mensaje:",n)}finally{d(!1)}}};return e.jsxs("form",{className:"flex items-center w-full gap-1",onSubmit:s,disabled:o,children:[e.jsx(P,{variant:"bordered",color:"primary",type:"text",placeholder:"Agregar comentario",value:l,onChange:m=>c(m.target.value),classNames:R}),e.jsx(A,{isIconOnly:!0,className:"p-0 rounded-l-none",type:"submit",disabled:o,children:e.jsx("i",{className:"text-palette-blue fa-solid fa-paper-plane group-hover:text-blue-600"})})]})},R={inputWrapper:["rounded-r-none"]};function $({setSelectedUser:i,setSelectedThreadId:r,selectedUser:l,filteredUsers:c}){const{threads:h}=S(),{myUsername:f}=C(),{loading:o}=a.useContext(w),d=s=>{var n;i(s);const m=(n=h.find(t=>t.first_person===s.user.username&&t.second_person===f||t.first_person===f&&t.second_person===s.user.username))==null?void 0:n.id;r(m)};return e.jsxs("section",{className:`flex-col lg:w-3/12 h-full overflow-auto lg:border-r lg:border-palette-2 ${l?"max-lg:hidden":"max-lg:block "}`,children:[e.jsx("h2",{className:"p-3 text-2xl font-semibold",children:"Amigos"}),e.jsx("ul",{className:"gap-2",children:c.map(s=>e.jsx("li",{onClick:()=>d(s),className:`flex items-center cursor-pointer my-1 p-2 gap-2 hover:bg-palette-2 w-full  ${l===s?"bg-palette-2 border-r border-palette-5 hover:bg-palette-4 hover:border-palette-6":""}`,children:o?e.jsxs("div",{className:"flex items-center w-full gap-4 p-2",children:[e.jsx(v,{className:"object-cover w-12 h-12 rounded-full"}),e.jsx(v,{className:"w-3/4 h-3 rounded-lg"})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s.foto_perfil,className:"object-cover w-12 h-12 transition-transform rounded-full",alt:`${s.user.username} profile`}),e.jsx("span",{className:"text-xl",children:s.user.username.charAt(0).toUpperCase()+s.user.username.slice(1)})]})},s.user.id))})]})}const k=a.lazy(()=>E(()=>import("./MessagesChatPanel-584ab6a4.js"),["assets/MessagesChatPanel-584ab6a4.js","assets/index-f33d37de.js","assets/index-041432e3.css","assets/axios-21b846bc.js","assets/baseUrl-32bae851.js","assets/useProfileThreads-bf1302ec.js"]));function Q(){var g,j;const{threads:i}=S(),{myUserData:r}=C(),{loading:l,setLoading:c}=a.useContext(w),[h,f]=a.useState([]),[o,d]=a.useState(null),[s,m]=a.useState(null),n=a.useRef(null),t=(g=r==null?void 0:r.user)==null?void 0:g.username,p=(j=r==null?void 0:r.user)==null?void 0:j.id;return a.useEffect(()=>{(async()=>{if(c(!0),t&&i){const U=i.reduce((u,b)=>{const{first_person:x,second_person:_}=b;return x!==t&&u.push(x),_!==t&&u.push(_),u},[]).filter(u=>u!==p),I=await Promise.all(U.map(async u=>{const x={...(await y.get(M(u))).data};return x.foto_perfil=`${T}${x.foto_perfil}`,x}));f(I)}})(),c(!1)},[p,i,t]),e.jsxs("div",{className:"flex w-full h-full max-md:px-2 lg:h-full lg:w-full max-lg:flex-col",children:[h.length>0?e.jsx($,{selectedUser:o,setSelectedThreadId:m,setSelectedUser:d,filteredUsers:h}):e.jsx(e.Fragment,{children:l?e.jsx(N,{className:"w-full mt-4"}):e.jsxs("div",{className:"flex justify-center w-full pt-10 text-xl font-semibold",children:[e.jsx("h2",{className:"opacity-40",children:"Haz amigos para poder chatear con ellos"}),e.jsx("span",{children:"ü§ù"})]})}),o&&e.jsxs("section",{className:"relative flex flex-col w-full h-full lg:w-9/12 rounded-xl",children:[e.jsx(a.Suspense,{fallback:e.jsx(N,{}),className:"h-full",children:e.jsx(k,{messagesContainerRef:n,myUserId:p,selectedThreadId:s,selectedUser:o,setSelectedUser:d})}),e.jsx("footer",{className:"flex items-center justify-center w-full p-4",children:e.jsx(L,{myUserId:p,selectedThreadId:s})})]})]})}export{Q as ChatPage,Q as default};
