import{r as i,V as b,L as p,F as C,j as e,s as y}from"./index-8fcd2ec0.js";import{B as N}from"./baseUrl-32bae851.js";import{a as h}from"./axios-21b846bc.js";import{s as V,v as S}from"./urlsAuthentication-d973b73d.js";const E=({canResendCode:n,setCanResendCode:s,setRemainingTime:x,remainingTime:c,setVerificationSuccess:d})=>{const{verificationCodeGenerated:m}=i.useContext(b),[f,a]=i.useState(!1),[g,o]=i.useState(!0),{loading:l,setLoading:u}=i.useContext(p),{formData:t,setFormData:v}=i.useContext(C),w=async()=>{u(!0);try{await h.post(V,{email:t.email,username:t.username,password:t.password}),s(!1),x(180),a(!0),setTimeout(()=>{a(!1)},3e3)}catch(r){console.error("Error al enviar el correo de verificación:",r)}finally{u(!1)}},j=async()=>{u(!0);try{(await h.post(S,{codigo:t.verificationCode,verification_code:m,username:t.username,email:t.email,password:t.password})).data.message==="Verificación exitosa"&&(o(!1),d(!0),window.localStorage.removeItem("jwt"),window.localStorage.removeItem("formData"),window.localStorage.removeItem("Code verification"))}catch(r){v({...t,verificationCode:""}),console.error("Error al verificar el código:",r)}finally{console.log(m),u(!1)}};return e.jsx(e.Fragment,{children:g&&e.jsxs("form",{method:"POST",children:[e.jsxs("p",{className:"font-semibold text-gray-700",children:["Se ha enviado un correo electrónico a ",e.jsx("strong",{children:t.email})," con el código de verificación."]}),e.jsx("input",{type:"text",placeholder:"Código de Verificación",value:t.verificationCode,onChange:r=>v({...t,verificationCode:r.target.value}),maxLength:6,className:"block my-2 w-2/3 rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 indent-2"}),l?e.jsx(y,{animation:"border",variant:"primary"}):e.jsxs("div",{className:"p-4",children:[e.jsx("button",{onClick:j,className:"flex items-center justify-center w-full rounded-md bg-red-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600",children:"Verificar Código"}),e.jsxs("button",{onClick:w,disabled:!n,className:`flex items-center justify-center w-full rounded-md bg-indigo-600 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm  focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 mt-2 ${n?"hover:bg-indigo-500":"opacity-50 cursor-not-allowed"}`,children:["Reenviar Codigo ",n?"":`(${c}s)`]})]}),f&&e.jsx("p",{className:"text-gray-700",children:"Codigo Reenviado"})]})})},I="/media/icons/logo_text.webp";function D(){const{loading:n}=i.useContext(p),[s,x]=i.useState(),[c,d]=i.useState(60),[m,f]=i.useState(),[a,g]=i.useState(3);return i.useEffect(()=>{if(s){const o=setInterval(()=>{g(l=>l-1)},1e3);return a===0&&(clearInterval(o),window.location.href="/login"),()=>clearInterval(o)}},[s,a]),i.useEffect(()=>{let o;return c>0?o=setInterval(()=>{d(l=>l-1)},1e3):(f(!0),clearInterval(o)),()=>clearInterval(o)},[c]),e.jsx("div",{className:"flex flex-col justify-center min-h-screen px-6 py-12 bg-gradient-to-tr from-blue-400 to-red-300 lg:px-8",children:e.jsxs("main",{className:"h-full p-6 mx-auto overflow-y-auto bg-gray-200 border-2 border-gray-300 rounded-md shadow-sm md:max-w-screen-sm w-80 md:w-96",children:[e.jsx("header",{className:"flex items-center justify-center w-full",children:e.jsx("img",{src:N+I,alt:"Logo",className:"object-cover w-40 h-20"})}),e.jsx(E,{canResendCode:m,setCanResendCode:f,remainingTime:c,setRemainingTime:d,setVerificationSuccess:x}),s!==void 0&&e.jsx(e.Fragment,{children:s?e.jsx(e.Fragment,{children:n?e.jsx(Spinner,{size:"lg"}):e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsx("h2",{className:"text-2xl text-black",children:"¡Código verificado con éxito! Puedes iniciar sesión ahora."}),e.jsxs("p",{className:"text-xl text-black",children:["Redireccionando al inicio de sesión en",e.jsxs("span",{className:"text-black",children:[" ",a]})]}),e.jsx("i",{className:"mx-auto text-4xl text-green-600 fa-solid fa-check"})]})}):e.jsx("p",{className:"mt-4 text-red-500",children:"El código es incorrecto. Por favor, verifica nuevamente."})})]})})}export{D as VerificationViewPage,D as default};
