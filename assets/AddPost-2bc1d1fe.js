import{r as o,j as e,L as P,s as R}from"./index-f33d37de.js";import{a as U}from"./axios-21b846bc.js";import{u as L}from"./useMyProfileData-3913a7c4.js";import{c as z}from"./urlsPost-9698314f.js";import{l as G}from"./cropper-9d738a46.js";import"./urlsUsers-ca1c08d1.js";import"./baseUrl-32bae851.js";function A({imagePreviewUrl:u,setCropper:l}){const i=o.useRef(null);return e.jsx(G,{ref:i,src:u,className:"flex items-center justify-center object-cover w-full h-full border border-gray-400 md:w-468 md:h-468 max-h-96",aspectRatio:1,guides:!0,viewMode:1,background:!1,zoomable:!1,onInitialized:c=>{l(c)},minCanvasWidth:320,minCanvasHeight:320})}function H({setNavBarView:u}){const{loading:l,setLoading:i}=o.useContext(P),[c,f]=o.useState(""),[m,s]=o.useState(null),[h,p]=o.useState(!1),[b,d]=o.useState(null),[w,v]=o.useState(null),[x,g]=o.useState(null),[y,j]=o.useState(null),{myUsername:N}=L();u(!1);const C=async r=>{r.preventDefault();try{i(!0);const t=new FormData;t.append("caption",c),t.append("image",x);const a=window.localStorage.getItem("token");await U.post(z,t,{headers:{Authorization:`Token ${a}`,"Content-Type":"multipart/form-data"}}),window.location.href=`/profile/${N}`}catch(t){console.error("Error al crear la publicación:",t)}finally{i(!1)}},D=r=>{const t=r.target.files[0];if(t){s(t);const a=new window.FileReader;a.onload=n=>{d(n.target.result)},a.readAsDataURL(t)}},k=r=>{r.preventDefault(),p(!0)},I=()=>{p(!1)},F=r=>{r.preventDefault(),p(!1);const t=r.dataTransfer.files[0];if(s(t),t){const a=new window.FileReader;a.onload=n=>{d(n.target.result)},a.readAsDataURL(t)}},S=()=>{const r=y.getCroppedCanvas(),t=r.toDataURL("image/webp");r&&v(t),r.toBlob(a=>{if(a){const n=new File([a],m.name,{type:"image/webp"});g(n)}},"image/webp"),s(!1)};return e.jsx("form",{className:`flex h-screen items-center justify-center overflow-hidden bg-white font-sans py-6 ${h?"border-4 border-dashed border-blue-500":""}`,children:e.jsxs("div",{className:"flex flex-col h-full p-6 mx-4 overflow-auto bg-white border-2 border-gray-300 shadow-xl max-sm:w-full rounded-2xl",children:[m&&e.jsxs("div",{className:"max-w-lg mx-auto mt-4",children:[e.jsx(A,{imagePreviewUrl:b,setCropper:j}),e.jsxs("div",{className:"flex justify-center w-full mt-4",children:[e.jsx("button",{type:"button",className:"px-4 py-2 mr-4 text-sm font-medium text-gray-700 border border-gray-300 rounded hover:text-gray-500 focus:outline-none focus:ring focus:ring-gray-200",onClick:()=>{s(null),d(null)},children:"Cancelar"}),e.jsx("button",{type:"button",className:"px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded hover:bg-indigo-500 focus:outline-none focus:ring focus:ring-indigo-500",onClick:S,children:"Guardar"})]})]}),!m&&!x&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mb-5 text-3xl font-bold text-gray-700 max-lg:hidden",children:"Crear publicación"}),e.jsxs("label",{className:"flex flex-col items-center w-full max-w-lg p-6 mx-auto text-center bg-white border-2 border-blue-400 border-dashed cursor-pointer my rounded-xl",onDragOver:k,onDragLeave:I,onDrop:F,children:[e.jsx("i",{className:"text-6xl text-blue-500 fa-solid fa-arrow-up-from-bracket"}),e.jsx("h2",{className:"mt-4 text-xl font-medium tracking-wide text-gray-700",children:"Subir archivo"}),e.jsx("p",{className:"mt-2 tracking-wide text-gray-500",children:"Sube o arrastra y suelta tu archivo SVG, PNG, JPG o GIF."}),e.jsx("input",{id:"dropzone-file",type:"file",accept:"image/*",className:"hidden",onChange:D})]})]}),x&&e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"flex flex-col items-center max-w-lg p-6 mx-auto text-center bg-white border-2 border-blue-400 border-dashed rounded-xl",children:e.jsx("img",{src:w,alt:"Imagen de vista previa",className:"object-cover mx-auto md:w-80 w-60 h-60 rounded-xl md:h-80"})}),e.jsxs("label",{htmlFor:"Descripcion",className:"relative block w-full h-12 p-2 mx-auto my-10 border border-gray-200 rounded-md shadow-sm focus-within:border-blue-600 focus-within:ring-1 focus-within:ring-blue-600",children:[e.jsx("input",{type:"text",placeholder:"Descripcion",className:"w-full h-full text-black placeholder-transparent bg-transparent border-none peer focus:border-transparent focus:outline-none focus:ring-0",value:c,required:!0,onChange:r=>f(r.target.value)}),e.jsx("span",{className:"pointer-events-none absolute start-2.5 top-0 -translate-y-1/2 bg-white p-0.5 text-xs text-gray-700 transition-all peer-placeholder-shown:top-1/2 peer-placeholder-shown:text-sm peer-focus:top-0 peer-focus:text-xs",children:"Descripción"})]}),e.jsxs("footer",{className:"relative bottom-0 flex justify-end mt-auto",children:[e.jsx("button",{type:"reset",className:"mr-6",onClick:()=>{s(null),d(null),g(null),f("")},children:e.jsx("i",{className:"text-2xl text-red-600 transition-all fa-solid fa-trash-can hover:scale-110 hover:shadow-xl"})}),e.jsx("button",{type:"submit",className:"px-8 py-3 text-sm font-medium text-white transition bg-indigo-600 rounded hover:scale-110 hover:shadow-xl focus:outline-none focus:ring active:bg-indigo-500",onClick:C,disabled:l,children:e.jsx("span",{children:l?e.jsx(R,{size:"sm"}):"Publicar"})})]})]})]})})}export{H as default};
