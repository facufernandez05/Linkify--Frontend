import{j as t,r as m}from"./index-8fcd2ec0.js";import{a as x}from"./axios-21b846bc.js";import{b as h}from"./baseUrl-32bae851.js";import{g as d}from"./useProfileThreads-1bf91c97.js";function g(s){const o=/(\bhttps?:\/\/\S+\b)/gi;return s.split(o).map((r,i)=>r.match(o)?t.jsx("a",{href:r,target:"_blank",className:"text-blue-400 md:hover:underline max-md:underline",children:r},i):r)}function p({message:s,myUserId:o}){const e=s.user===o;return t.jsx("div",{className:`flex p-4 ${e?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`md:mt-7.5 p-3 rounded-lg md:p-4 inline-block max-w-md break-words tracking-wider text-sm md:text-lg relative ${e?"text-white bg-red-600":"text-black bg-white"} font-medium`,children:[g(s.message),t.jsx("span",{className:`text-sm text-gray-400 absolute ${e?"right-1":"left-1"} -bottom-6`,children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})})}function u(s,o){try{if(s){const e=new WebSocket(`ws://${h}/chat/${s}/`);return e.onmessage=n=>{const r=JSON.parse(n.data),i=r.message,c=r.user,a=r.thread,l=r.timestamp;o(f=>[...f,{message:i,user:c,thread:a,timestamp:l}])},e}}catch(e){console.error("Error establishing WebSocket:",e)}}const w=({messagesContainerRef:s,myUserId:o,selectedUser:e,selectedThreadId:n,setSelectedUser:r})=>{const[i,c]=m.useState([]);return m.useEffect(()=>{async function a(){try{if(n){const l=await x.get(d(n));c(l.data)}}catch(l){console.error("Error fetching chat messages:",l)}}a()},[n]),m.useEffect(()=>{u(n,c);const a=u();return()=>{a&&a.readyState===WebSocket.OPEN&&a.close()}},[n,c]),m.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[i,n]),t.jsxs(t.Fragment,{children:[t.jsxs("header",{className:"flex items-center h-10 my-3 md:ml-6 md:h-20",children:[t.jsx("button",{className:`lg:hidden text-2xl flex justify-start items-center p-2 ${e?"block":"hidden"}`,onClick:()=>r(!1),children:t.jsx("i",{className:"transition-transform fa-solid fa-circle-chevron-left hover:scale-110"})}),t.jsxs("div",{className:"flex max-lg:ml-4",children:[t.jsx("img",{src:e.foto_perfil,className:"object-cover w-10 h-10 mr-2 transition-transform rounded-full md:w-16 md:h-16",alt:`${e.user.username} profile`}),t.jsx("a",{href:`/profile/${e.user.username}`,className:"flex items-center my-auto text-lg font-semibold",children:t.jsx("span",{className:"flex items-center text-xl md:text-2xl",children:e.user.username.charAt(0).toUpperCase()+e.user.username.slice(1)})})]})]}),t.jsx("hr",{className:"border-palette-2"}),t.jsx("main",{ref:s,className:"relative flex-col flex-1 w-full h-full overflow-y-auto",children:i&&i.map(a=>t.jsx(p,{message:a,myUserId:o},a.id))})]})};export{w as MessagesChatPanel,w as default};
